<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CineGenesis: Kinetic Restoration</title>
    
    <!-- CORE LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- FIREBASE SDK (Modular - Fixed Bridge) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // ===============================================================
        //  YOUR INTEGRATED KEYS (PRE-FILLED)
        // ===============================================================
        const firebaseConfig = {
            apiKey: "AIzaSyAhbTjjNsL32-_ElgZR1V0XuMWtRrlnNVM",
            authDomain: "cinegenesis-os.firebaseapp.com",
            projectId: "cinegenesis-os",
            storageBucket: "cinegenesis-os.firebasestorage.app",
            messagingSenderId: "441370974988",
            appId: "1:441370974988:web:a2453282a4344c201e8729"
        };
        // ===============================================================

        try {
            // INITIALIZE FIREBASE (SINGLE INSTANCE)
            const app = initializeApp(firebaseConfig);
            window.auth = getAuth(app);
            window.db = getFirestore(app);
            window.googleProvider = new GoogleAuthProvider();
            
            // BRIDGE FUNCTIONS
            window.fbSignIn = signInWithPopup;
            window.fbSignOut = signOut;
            window.fbOnAuth = onAuthStateChanged;
            
            console.log("OS: Kinetic & Spine Online.");
        } catch (e) {
            console.error("OS: Config Error.", e);
        }
    </script>

    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #050505; color: #E5E5E5; height: 100vh; overflow: hidden; margin: 0; -webkit-font-smoothing: antialiased; }
        
        /* GLASS UI */
        .glass-panel { background: rgba(10, 10, 10, 0.4); backdrop-filter: blur(24px); border: 1px solid rgba(255, 255, 255, 0.06); box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5); }
        .btn-ignite { background: radial-gradient(circle at center, #FFF, #E5E5E5); box-shadow: 0 0 30px rgba(255, 255, 255, 0.1); transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .btn-ignite:hover { transform: scale(1.02); box-shadow: 0 0 50px rgba(212, 175, 55, 0.5); }
        
        /* KINETIC LAYERS */
        .kinetic-loop { position: absolute; inset: 0; transition: opacity 0.1s ease; mix-blend-mode: hard-light; }
        .kinetic-active { opacity: 1; animation: flash 0.1s infinite; }
        @keyframes flash { 0% { transform: scale(1); filter: brightness(1); } 50% { transform: scale(1.05); filter: brightness(1.2); } 100% { transform: scale(1); } }
        
        /* THEME ACCENTS */
        .season-banner { background: linear-gradient(90deg, #D4AF37 0%, #FDE047 50%, #D4AF37 100%); background-size: 200% auto; animation: shine 3s linear infinite; -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        @keyframes shine { to { background-position: 200% center; } }
        
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const Icon = ({ name, size = 16, className = "" }) => {
            const s = size; const c = `stroke-current ${className}`; const p = { strokeWidth: 2, fill: "none", strokeLinecap: "round", strokeLinejoin: "round" };
            if (name === 'lock') return <svg width={s} height={s} viewBox="0 0 24 24" {...p} className={c}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
            if (name === 'login') return <svg width={s} height={s} viewBox="0 0 24 24" {...p} className={c}><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>;
            if (name === 'fastforward') return <svg width={s} height={s} viewBox="0 0 24 24" {...p} className={c}><polygon points="13 19 22 12 13 5 13 19"/><polygon points="2 19 11 12 2 5 2 19"/></svg>;
            if (name === 'zap') return <svg width={s} height={s} viewBox="0 0 24 24" {...p} className={c}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
            return null;
        };

        // --- SOUND ENGINE ---
        const SoundEngine = {
            ctx: null,
            init: function() { 
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            },
            playTone: function(freq, type, duration, vol = 0.1) {
                this.init();
                const osc = this.ctx.createOscillator(); const gain = this.ctx.createGain();
                osc.type = type; osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(vol, this.ctx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                osc.connect(gain); gain.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + duration);
            },
            playStrobe: function() { this.playTone(150, 'sawtooth', 0.05, 0.1); },
            playSuccess: function() { this.playTone(600, 'sine', 0.1, 0.1); setTimeout(() => this.playTone(900, 'sine', 0.3, 0.1), 100); }
        };

        // --- COMPONENTS ---

        // KINETIC SYNC (RESTORED)
        const KineticSync = ({ onComplete }) => {
            const [syncing, setSyncing] = useState(false);
            const [mode, setMode] = useState(0);
            const timer = useRef(null);
            // The Original Loops
            const loops = [{type:'VELOCITY', bg:'linear-gradient(45deg, #ff0000, #000)'}, {type:'DREAM', bg:'radial-gradient(circle, #0000ff, #000)'}, {type:'GLITCH', bg:'repeating-linear-gradient(90deg, #333, #000 10px)'}];

            const startScan = () => { 
                SoundEngine.init();
                setSyncing(true); 
                if (intervalRef.current) clearInterval(intervalRef.current);
                intervalRef.current = setInterval(() => { setActiveLoop(p => (p + 1) % loops.length); SoundEngine.playStrobe(); }, 150); 
            };
            const stopScan = () => { 
                if (!isScanning) return;
                setSyncing(false); 
                clearInterval(intervalRef.current); 
                intervalRef.current = null;
                SoundEngine.playSuccess();
                setTimeout(onComplete, 500); 
            };
            
            // Helper for state
            const [activeLoop, setActiveLoop] = useState(0);
            const [isScanning, setIsScanning] = useState(false);

            // Re-using the logic you loved
            const start = () => {
                 SoundEngine.init();
                 setIsScanning(true);
                 if (timer.current) clearInterval(timer.current);
                 timer.current = setInterval(() => { setActiveLoop(p => (p + 1) % loops.length); SoundEngine.playStrobe(); }, 150);
            };
            const stop = () => {
                if (!isScanning) return;
                setIsScanning(false);
                clearInterval(timer.current);
                SoundEngine.playSuccess();
                setTimeout(onComplete, 500);
            };

            return (
                <div className="w-full flex-1 flex flex-col items-center justify-center h-full relative overflow-hidden bg-black select-none" onMouseDown={start} onMouseUp={stop} onMouseLeave={stop} onTouchStart={start} onTouchEnd={stop}>
                    <div className="absolute inset-0 z-0">{loops.map((l, i) => (<div key={i} className={`kinetic-loop ${i === activeLoop ? 'kinetic-active' : ''}`} style={{ background: l.bg }}></div>))}</div>
                    <div className="relative z-10 text-center space-y-8">
                        <h2 className="text-3xl font-bold text-white tracking-widest uppercase mix-blend-difference">{isScanning ? 'SYNCING RHYTHM...' : 'HOLD TO CALIBRATE'}</h2>
                        <div className="text-[80px] md:text-[120px] font-black text-transparent bg-clip-text bg-white opacity-20 select-none">{loops[activeLoop].type}</div>
                        <div className={`w-24 h-24 mx-auto rounded-full border-4 border-white/20 flex items-center justify-center transition-all duration-100 ${isScanning ? 'bg-white scale-110 shadow-[0_0_100px_white]' : 'bg-transparent hover:border-white'}`}>
                            <Icon name="fastforward" size={32} className={isScanning ? 'text-black' : 'text-white'} />
                        </div>
                    </div>
                </div>
            );
        };

        // AUTH HOOK
        const useAuth = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const checkFirebase = setInterval(() => {
                    if (window.auth && window.fbOnAuth) {
                        clearInterval(checkFirebase);
                        window.fbOnAuth(window.auth, (u) => {
                            setUser(u);
                            setLoading(false);
                        });
                    }
                }, 100);
                return () => clearInterval(checkFirebase);
            }, []);

            const signIn = async () => {
                if (!window.auth) return alert("Firebase Config Missing!");
                try {
                    await window.fbSignIn(window.auth, window.googleProvider);
                } catch (error) {
                    console.error("Login Failed", error);
                    alert("Login Failed: " + error.message);
                }
            };

            return { user, loading, signIn };
        };

        // --- MAIN APP ---
        const App = () => {
            const { user, signIn, loading } = useAuth();
            const [view, setView] = useState('KINETIC');

            // Logic: If already logged in, we still show Kinetic first, then jump
            useEffect(() => {
                // Optional: You can force skip if you want, but for now we follow the flow
            }, [user]);

            return (
                <div className="h-screen w-full flex flex-col bg-[#050505]">
                    {view === 'KINETIC' && <KineticSync onComplete={() => setView('LOGIN')} />}

                    {view === 'LOGIN' && (
                         <div className="h-screen w-full flex items-center justify-center bg-black px-6">
                            <div className="w-full max-w-sm glass-panel p-10 rounded-2xl text-center space-y-8 border border-white/10 shadow-2xl animate-fade-in">
                                <div className="w-14 h-14 bg-white/5 border border-[#D4AF37] rounded-full flex items-center justify-center mx-auto shadow-[0_0_20px_rgba(212,175,55,0.2)]">
                                    <Icon name="lock" size={24} className="text-[#D4AF37]" />
                                </div>
                                <div>
                                    <h2 className="text-2xl font-serif text-white tracking-widest uppercase">Neural Link</h2>
                                    <p className="text-[10px] text-white/30 font-mono uppercase mt-2 tracking-[0.2em]">CineGenesis Clean Slate</p>
                                </div>
                                
                                {user ? (
                                    <div className="text-green-400 font-mono text-xs animate-pulse">IDENTITY VERIFIED: {user.displayName}</div>
                                ) : (
                                    <button onClick={signIn} disabled={loading} className="w-full py-4 btn-ignite text-[10px] font-bold tracking-[0.3em] rounded-xl uppercase flex items-center justify-center gap-2">
                                        {loading ? "LOADING..." : <><Icon name="login" size={14}/> CONNECT IDENTITY</>}
                                    </button>
                                )}
                                
                                <div className="pt-4 border-t border-white/5">
                                    <p className="text-[8px] font-mono text-white/20 uppercase tracking-widest leading-loose">Secure Checkpoint v19.5</p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
